<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulk UPC Label Generator - Professional Edition</title>
  <style>
    /* --- GLOBAL RESET --- */
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8fafc;
      color: #1e293b;
    }

    /* --- INPUT FORM STYLING --- */
    .input-panel {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e2e8f0;
    }

    .header-section {
      text-align: center;
      margin-bottom: 35px;
      padding-bottom: 25px;
      border-bottom: 3px solid #3b82f6;
    }

    .input-panel h1 { 
      font-size: 32px;
      font-weight: 800;
      color: #1e40af;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: #64748b;
      font-size: 15px;
      font-weight: 500;
    }

    .alert-box {
      background: #fef3c7;
      border: 2px solid #fbbf24;
      border-radius: 10px;
      padding: 14px 18px;
      margin-bottom: 25px;
      font-size: 14px;
      font-weight: 600;
      color: #92400e;
    }
    
    .form-group { 
      margin-bottom: 24px; 
    }
    
    .form-group label { 
      display: block; 
      font-weight: 700; 
      margin-bottom: 8px;
      color: #334155;
      font-size: 15px;
    }
    
    input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #cbd5e1;
      border-radius: 10px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s ease;
      background: #f8fafc;
    }

    input:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    textarea {
      width: 100%;
      padding: 16px;
      border: 2px solid #cbd5e1;
      border-radius: 10px;
      font-size: 15px;
      font-family: 'Consolas', 'Courier New', monospace;
      transition: all 0.3s ease;
      background: #f8fafc;
      resize: vertical;
      min-height: 220px;
      line-height: 1.6;
    }

    textarea:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    textarea::placeholder {
      color: #94a3b8;
      font-style: italic;
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 30px;
    }
    
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.3);
      flex: 1;
      min-width: 180px;
    }
    
    button:hover { 
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }

    button:active {
      transform: translateY(0);
    }
    
    .btn-print { 
      background: #10b981;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3);
    }
    
    .btn-print:hover { 
      background: #059669;
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    /* --- PRINT PREVIEW AREA --- */
    #previewArea {
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      gap: 30px;
    }

    /* --- A4 PAGE - SCREEN VIEW --- */
    .page {
      width: 210mm;
      height: 297mm;
      background: white;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      border: 1px solid #e2e8f0;
      position: relative;
      padding: 0;
      page-break-after: always;
      display: flex;
      flex-direction: column;
    }

    /* --- LABEL CONTAINER (EXACTLY 3 PER PAGE) --- */
    .label-container {
      width: 210mm;
      height: 99mm; /* 297mm / 3 = 99mm per label */
      
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      
      border: 3px solid #1e293b;
      border-top: none;
      
      padding: 10px;
      background: #ffffff;
      position: relative;
    }

    .label-container:first-child {
      border-top: 3px solid #1e293b;
    }

    /* --- TEXT STYLING --- */
    .txt-name { 
      font-size: 26pt; 
      font-weight: 900; 
      text-transform: uppercase; 
      margin: 0 0 8px 0;
      line-height: 1.1;
      color: #0f172a;
    }
    
    .txt-comp { 
      font-size: 18pt; 
      font-weight: 700; 
      margin: 0 0 8px 0;
      color: #334155;
    }
    
    .txt-ware { 
      font-size: 17pt; 
      font-weight: 900;
      margin: 0 0 12px 0;
      color: #1e40af;
    }

    .barcode-svg {
      width: 75%;
      max-width: 400px;
      height: 70px;
      margin: 10px 0;
      display: block;
    }

    .txt-meta {
      font-size: 20pt; 
      font-weight: 700;
      margin: 4px 0;
      color: #0f172a;
    }

    /* --- RESPONSIVE DESIGN FOR MOBILE/TABLET --- */
    @media (max-width: 968px) {
      body {
        padding: 10px;
      }

      .input-panel {
        padding: 30px 20px;
        border-radius: 12px;
      }

      .input-panel h1 {
        font-size: 28px;
      }

      .page {
        transform: scale(0.7);
        transform-origin: top center;
        margin-bottom: -90mm;
      }
    }

    @media (max-width: 768px) {
      .input-panel {
        padding: 25px 18px;
      }

      .input-panel h1 {
        font-size: 24px;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
        min-width: auto;
      }

      .page {
        transform: scale(0.5);
        margin-bottom: -150mm;
      }
    }

    @media (max-width: 480px) {
      .input-panel h1 {
        font-size: 20px;
      }

      input, textarea {
        font-size: 14px;
        padding: 12px;
      }

      textarea {
        min-height: 180px;
      }

      .page {
        transform: scale(0.35);
        margin-bottom: -195mm;
      }
    }

    /* --- CRITICAL PRINT CSS FOR PERFECT A4 OUTPUT --- */
    @page {
      size: A4 portrait;
      margin: 0;
    }

    @media print {
      html, body {
        width: 210mm;
        height: 297mm;
        margin: 0;
        padding: 0;
        background: white;
      }
      
      .input-panel { 
        display: none !important; 
      }

      #previewArea {
        margin: 0;
        padding: 0;
        gap: 0;
      }
      
      .page {
        margin: 0;
        padding: 0;
        box-shadow: none;
        border: none;
        width: 210mm;
        height: 297mm;
        page-break-after: always;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      
      .page:last-child {
        page-break-after: auto;
      }

      .label-container {
        width: 210mm;
        height: 99mm;
        border: 3px solid #000;
        border-top: none;
        padding: 8mm;
        page-break-inside: avoid;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .label-container:first-child {
        border-top: 3px solid #000;
      }

      /* Ensure exact sizing for print */
      .txt-name { 
        font-size: 26pt; 
        margin: 0 0 6px 0;
      }
      
      .txt-comp { 
        font-size: 18pt; 
        margin: 0 0 6px 0;
      }
      
      .txt-ware { 
        font-size: 17pt; 
        margin: 0 0 10px 0;
      }

      .barcode-svg {
        width: 75%;
        height: 70px;
        margin: 8px 0;
      }

      .txt-meta {
        font-size: 20pt; 
        margin: 3px 0;
      }
    }
  </style>
</head>
<body>

  <!-- INPUT FORM -->
  <div class="input-panel">
    <div class="header-section">
      <h1>üì¶ Professional UPC Label Generator</h1>
      <p class="subtitle">Perfect A4 printing ‚Ä¢ 3 labels per sheet</p>
    </div>

    <div class="alert-box">
      ‚ö†Ô∏è <strong>Print Settings:</strong> Set page size to A4, orientation to Portrait, and margins to "None" or "Minimum"
    </div>

    <div class="form-group">
      <label>üìù Line 1 (Name)</label>
      <input type="text" id="line1" value="Nilu's collection,">
    </div>

    <div class="form-group">
      <label>üè¢ Line 2 (Company)</label>
      <input type="text" id="line2" value="BLINK COMMERCE PRIVATE LIMITED">
    </div>

    <div class="form-group">
      <label>üìç Line 3 (Warehouse - BOLD)</label>
      <input type="text" id="line3" value="Hyderabad H3 - Feeder Warehouse">
    </div>

    <div class="form-group">
      <label>üî¢ UPC Data (Format: UPC,Quantity)</label>
      <textarea id="upcData" placeholder="20110519,31
20110520,15
20110521,6
20110522,10
20110523,25

Add more lines as needed..."></textarea>
    </div>

    <div class="button-group">
      <button onclick="generateLabels()">üîÑ Generate Preview</button>
      <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print Labels</button>
    </div>
  </div>

  <!-- PREVIEW / PRINT AREA -->
  <div id="previewArea"></div>

  <!-- JS BARCODE LIBRARY -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

  <script>
    function generateLabels() {
      const line1 = document.getElementById('line1').value;
      const line2 = document.getElementById('line2').value;
      const line3 = document.getElementById('line3').value;
      const rawData = document.getElementById('upcData').value.trim();

      if (!rawData) { 
        alert("‚ö†Ô∏è Please enter UPC data."); 
        return; 
      }

      const items = rawData.split('\n')
        .filter(l => l.trim())
        .map(l => {
          const [u, q] = l.split(',');
          return { upc: u?.trim(), qty: q?.trim() || '1' };
        })
        .filter(i => i.upc);

      if (items.length === 0) {
        alert("‚ö†Ô∏è No valid UPC data found. Format: UPC,Quantity");
        return;
      }

      const previewArea = document.getElementById('previewArea');
      previewArea.innerHTML = '';

      // Process items in groups of 3 (one page)
      for (let i = 0; i < items.length; i += 3) {
        const page = document.createElement('div');
        page.className = 'page';

        const chunk = items.slice(i, i + 3);

        // Always create exactly 3 label slots per page
        for (let j = 0; j < 3; j++) {
          const item = chunk[j];
          const labelDiv = document.createElement('div');
          labelDiv.className = 'label-container';

          if (item) {
            const bcId = `bc-${i}-${j}`;
            labelDiv.innerHTML = `
              <div class="txt-name">${escapeHtml(line1)}</div>
              <div class="txt-comp">${escapeHtml(line2)}</div>
              <div class="txt-ware">${escapeHtml(line3)}</div>
              <svg id="${bcId}" class="barcode-svg"></svg>
              <div class="txt-meta">UPC - ${escapeHtml(item.upc)}</div>
              <div class="txt-meta">Quantity - ${escapeHtml(item.qty)}</div>
            `;
            
            page.appendChild(labelDiv);

            // Generate barcode asynchronously
            setTimeout(() => {
              try {
                JsBarcode(`#${bcId}`, item.upc, {
                  format: "CODE128",
                  width: 3,
                  height: 65,
                  displayValue: true,
                  fontSize: 20,
                  fontOptions: "bold",
                  margin: 0
                });
              } catch (e) {
                console.error('Barcode generation error for UPC:', item.upc, e);
                document.getElementById(bcId).outerHTML = `<div style="color: red; font-weight: bold;">Invalid UPC: ${item.upc}</div>`;
              }
            }, 10);
          } else {
            // Empty slot - maintain structure but invisible
            labelDiv.style.border = "none";
            labelDiv.style.background = "transparent";
            page.appendChild(labelDiv);
          }
        }
        
        previewArea.appendChild(page);
      }

      // Smooth scroll to preview
      setTimeout(() => {
        previewArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 150);
    }

    // Helper function to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>

</body>
</html>
